(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const V=e=>{e.classList.toggle("card__like-button_is-active")},E=e=>{e.remove()},Z=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),U=(e,{onPreviewPicture:t,onLikeIcon:n,onDeleteCard:o,onInfoClick:r},s=null)=>{const c=Z(),f=c.querySelector(".card__like-button"),m=c.querySelector(".card__control-button_type_delete"),J=c.querySelector(".card__control-button_type_info"),v=c.querySelector(".card__image"),I=c.querySelector(".card__like-count");return v.src=e.link,v.alt=e.name,c.querySelector(".card__title").textContent=e.name,I&&(I.textContent=e.likes?e.likes.length:0),e.owner&&e.owner._id!==s&&(m.style.display="none"),n&&f.addEventListener("click",()=>n(f,e._id)),o&&m.addEventListener("click",()=>o(c,e._id)),t&&v.addEventListener("click",()=>t({name:e.name,link:e.link})),r&&J.addEventListener("click",()=>r(e._id)),c},T=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");l(t)}},u=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",T)},l=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",T)},K=e=>{const t=e.querySelector(".popup__close");t&&t.addEventListener("click",()=>{l(e)}),e.addEventListener("mousedown",n=>{n.target.classList.contains("popup")&&l(e)})};function y(e,t,n,o){const r=e.querySelector(`#${t.id}-error`);r.textContent=n,r.classList.add(o.errorClass),t.classList.add(o.inputErrorClass)}function w(e,t,n){const o=e.querySelector(`#${t.id}-error`);o.textContent="",o.classList.remove(n.errorClass),t.classList.remove(n.inputErrorClass)}function M(e,t,n){if(!t.value.trim())return y(e,t,"Поле обязательно для заполнения",n),!1;const o=(t.classList.contains("popup__input_type_name")||t.classList.contains("popup__input_type_card-name"),2),r=t.classList.contains("popup__input_type_name")||t.classList.contains("popup__input_type_card-name")?30:(t.classList.contains("popup__input_type_description"),200);if(t.value.length<o||t.value.length>r){let s="";return t.classList.contains("popup__input_type_name")||t.classList.contains("popup__input_type_card-name")?s="Длина должна быть от 2 до 30 символов":t.classList.contains("popup__input_type_description")?s="Длина должна быть от 2 до 200 символов":t.classList.contains("popup__input_type_url")&&(s="Введите корректную ссылку"),y(e,t,s,n),!1}if((t.classList.contains("popup__input_type_name")||t.classList.contains("popup__input_type_card-name"))&&!/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(t.value)){const c=t.dataset.errorMessage||"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";return y(e,t,c,n),!1}return t.classList.contains("popup__input_type_url")&&!/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([\/\w .-]*)*\.(jpg|jpeg|png|gif|svg|webp)(\?.*)?$/i.test(t.value)&&!/^(https?:\/\/)?[\w.-]+\.[a-zA-Z]{2,}\/?[\w\-._~:/?#[$@!$&'()*+,;=]*$/i.test(t.value)?(y(e,t,"Введите корректную ссылку",n),!1):(w(e,t,n),!0)}function G(e,t){const n=e.querySelectorAll(t.inputSelector);return Array.from(n).some(o=>!M(e,o,t))}function A(e,t){const n=e.querySelector(t.submitButtonSelector);n.disabled=!0,n.classList.add(t.inactiveButtonClass)}function Q(e,t){const n=e.querySelector(t.submitButtonSelector);n.disabled=!1,n.classList.remove(t.inactiveButtonClass)}function F(e,t){G(e,t)?A(e,t):Q(e,t)}function X(e,t){e.querySelectorAll(t.inputSelector).forEach(o=>{o.addEventListener("input",()=>{M(e,o,t),F(e,t)})})}function b(e,t){e.querySelectorAll(t.inputSelector).forEach(o=>{w(e,o,t)}),A(e,t)}function Y(e){document.querySelectorAll(e.formSelector).forEach(n=>{X(n,e),F(n,e)})}const a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"e8a5ade1-5ece-4656-ad1d-8400421905c0","Content-Type":"application/json"}},i=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ee=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(i),N=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(i),te=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(i),oe=({avatar:e})=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(i),ne=({name:e,link:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(i),B=e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(i),re=e=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:a.headers}).then(i),se=e=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:a.headers}).then(i),O=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),_=L.querySelector(".popup__form"),D=_.querySelector(".popup__input_type_name"),H=_.querySelector(".popup__input_type_description"),g=document.querySelector(".popup_type_new-card"),p=g.querySelector(".popup__form"),ce=p.querySelector(".popup__input_type_card-name"),ae=p.querySelector(".popup__input_type_url"),C=document.querySelector(".popup_type_image"),P=C.querySelector(".popup__image"),ie=C.querySelector(".popup__caption"),le=document.querySelector(".profile__edit-button"),pe=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),$=document.querySelector(".popup_type_edit-avatar"),d=$.querySelector(".popup__form"),ue=d.querySelector(".popup__input");let S=null;const de=e=>new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),R=({name:e,link:t})=>{P.src=t,P.alt=e,ie.textContent=e,u(C)},_e=e=>{e.preventDefault();const t=_.querySelector(".popup__button"),n=t.textContent;t.textContent="Сохранение...",t.disabled=!0,te({name:D.value,about:H.value}).then(o=>{q.textContent=o.name,k.textContent=o.about,l(L)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent=n,t.disabled=!1})},fe=e=>{e.preventDefault();const t=d.querySelector(".popup__button"),n=t.textContent;t.textContent="Сохранение...",t.disabled=!0,oe({avatar:ue.value}).then(o=>{x.style.backgroundImage=`url(${o.avatar})`,l($)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent=n,t.disabled=!1})},me=e=>{e.preventDefault();const t=p.querySelector(".popup__button"),n=t.textContent;t.textContent="Создание...",t.disabled=!0,ne({name:ce.value,link:ae.value}).then(o=>{O.prepend(U(o,{onPreviewPicture:R,onLikeIcon:r=>j(r,o._id),onDeleteCard:r=>z(r,o._id),onInfoClick:r=>W(r)},S)),l(g)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent=n,t.disabled=!1})},j=(e,t)=>{e.classList.contains("card__like-button_is-active")?se(t).then(o=>{const r=e.parentElement.querySelector(".card__like-count");r&&(r.textContent=o.likes.length)}).catch(o=>{console.log(o)}):re(t).then(o=>{const r=e.parentElement.querySelector(".card__like-count");r&&(r.textContent=o.likes.length)}).catch(o=>{console.log(o)}),V(e)},z=(e,t)=>{const n=document.querySelector(".popup_type_remove-card");n?(u(n),n.querySelector(".popup__button").addEventListener("click",()=>{B(t).then(()=>{E(e),l(n)}).catch(r=>{console.log(r)})})):B(t).then(()=>{E(e)}).catch(o=>{console.log(o)})},W=e=>{N().then(t=>{const n=t.find(m=>m._id===e);if(!n)return;const o=document.getElementById("popup-info-list");o.innerHTML="";const r=document.createElement("li");r.className="popup__info-item",r.innerHTML=`<span class="popup__info-key">Название:</span><span class="popup__info-value">${n.name}</span>`,o.appendChild(r);const s=document.createElement("li");s.className="popup__info-item",s.innerHTML=`<span class="popup__info-key">Ссылка:</span><span class="popup__info-value"><a href="${n.link}" target="_blank">${n.link}</a></span>`,o.appendChild(s);const c=document.createElement("li");c.className="popup__info-item",c.innerHTML=`<span class="popup__info-key">Дата создания:</span><span class="popup__info-value">${de(n.createdAt)}</span>`,o.appendChild(c);const f=document.querySelector(".popup_type_info");u(f)}).catch(t=>{console.log(t)})};le.addEventListener("click",()=>{D.value=q.textContent,H.value=k.textContent,b(_,h),u(L)});x.addEventListener("click",()=>{d.reset(),b(d,h),u($)});pe.addEventListener("click",()=>{p.reset(),b(p,h),u(g)});_.addEventListener("submit",_e);d.addEventListener("submit",fe);p.addEventListener("submit",me);Promise.all([N(),ee()]).then(([e,t])=>{S=t._id,q.textContent=t.name,k.textContent=t.about,x.style.backgroundImage=`url(${t.avatar})`,e.forEach(n=>{O.append(U(n,{onPreviewPicture:R,onLikeIcon:o=>j(o,n._id),onDeleteCard:o=>z(o,n._id),onInfoClick:o=>W(o)},S))})}).catch(e=>{console.log(e)});const ye=document.querySelectorAll(".popup");ye.forEach(e=>{K(e)});const h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};Y(h);
